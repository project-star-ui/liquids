<!DOCTYPE html>
<html lang="tl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google" content="notranslate">
  <title>Liquids Concept Map for Kids</title>
  <style>
    /* Universal Box Sizing for consistent layout */
    html {
      box-sizing: border-box;
    }
    *, *:before, *:after {
      box-sizing: inherit;
    }

    body {
      font-family: 'Comic Sans MS', arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      background: linear-gradient(to bottom, #b3e0ff, #1e90ff);
      animation: skyTransition 20s linear infinite alternate; /* Added alternate */
      min-height: 100vh;
      position: relative;
      overflow-x: hidden; /* Prevent horizontal scroll from fish */
    }
    .water-bg {
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 30%;
      background: #1e90ff; /* Water blue */
      z-index: -1;
      pointer-events: none;
      animation: waterFlow 10s ease-in-out infinite alternate; /* New water animation */
    }
    /* New: Water surface ripples */
    .water-bg::before {
      content: '';
      position: absolute;
      top: -10px; /* Slightly above the water line */
      left: 0;
      width: 100%;
      height: 20px;
      background: linear-gradient(to right, rgba(255,255,255,0.3), rgba(255,255,255,0.1), rgba(255,255,255,0.3));
      border-radius: 50%;
      filter: blur(5px);
      animation: waterRipples 5s linear infinite;
    }

    .title {
      font-size: 42px;
      color: #003366;
      text-shadow: 3px 3px 0 #fff;
      margin: 75px auto;
      display: inline-block;
      padding: 15px 30px;
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 50px;
      border: 5px dashed #1e90ff;
      cursor: pointer;
      position: relative;
      animation: floatTitle 3s ease-in-out infinite, pulseBorder 2s infinite alternate; /* Added pulseBorder */
      z-index: 2;
    }
    /* Specific styling for the hover popup on the main title */
    .title .box-hover-popup {
      bottom: -45px;
      font-size: 20px;
      font-weight: bold;
      padding: 10px 20px;
      background-color: #FFD700;
      color: #003366;
      border: 2px solid #FFA500;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    .container {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
      margin-top: 85px;
    }
    .box {
      border: 4px solid #fff;
      padding: 25px;
      border-radius: 30px;
      background-color: rgba(255, 255, 255, 0.9);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      font-size: 24px;
      color: #003366;
      width: 250px;
      min-height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: transform 0.3s;
      cursor: pointer;
      z-index: 1;
    }
    .box:hover {
      transform: scale(1.05);
      animation: shake 0.5s ease-in-out infinite;
    }
    /* New: Hover popup for boxes and title */
    .box-hover-popup {
      position: absolute;
      bottom: -35px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #1e90ff;
      color: white;
      padding: 5px 10px;
      border-radius: 8px;
      font-size: 14px;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
      z-index: 5;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    /* Show hover popup on parent hover */
    .box:hover .box-hover-popup,
    .title:hover .box-hover-popup {
      opacity: 1;
      visibility: visible;
    }

    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(255, 255, 255, 0.95); /* Slightly less transparent */
      border: 4px solid #1e90ff; /* Thicker border */
      border-radius: 25px; /* More rounded */
      padding: 25px; /* More padding */
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4); /* Stronger shadow */
      z-index: 10;
      width: 400px; /* Slightly wider */
      max-height: 85%; /* More height */
      overflow-y: auto;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.4s ease-in-out, visibility 0.4s ease-in-out, transform 0.4s ease-in-out; /* Added transform transition */
    }
    .popup.show {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1); /* Pop effect */
    }
    .popup h2 {
      color: #003366;
      font-size: 30px; /* Larger heading */
      margin-bottom: 15px;
    }
    .popup p {
      font-size: 18px; /* Larger text */
      line-height: 1.5;
      margin-bottom: 10px;
    }
    .popup ul {
      text-align: left;
      list-style-position: inside;
      padding-left: 0;
      font-size: 18px;
    }
    .popup ul li {
      margin-bottom: 5px;
    }
    .close-btn {
      background-color: #ff6b6b;
      color: white;
      border: none;
      border-radius: 10px; /* More rounded */
      padding: 12px 20px; /* Larger button */
      cursor: pointer;
      margin-top: 20px;
      font-size: 18px; /* Larger font */
      transition: background-color 0.3s, transform 0.2s;
    }
    .close-btn:hover {
      background-color: #e65a5a;
      transform: translateY(-2px);
    }
    .illustration {
      width: 90%; /* Slightly smaller to allow padding */
      height: auto;
      border-radius: 15px; /* More rounded corners */
      margin: 15px auto; /* Centered with more margin */
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    /* New: Dynamic illustrations for popups */
    .popup-illustration-container {
      position: relative;
      width: 100%;
      height: 200px; /* Fixed height for consistency */
      overflow: hidden;
      border-radius: 15px;
      background-color: #e0f7fa; /* Light blue background */
      margin: 15px 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .popup-illustration-container img,
    .popup-illustration-container svg {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      animation: fadeIn 1s ease-out;
    }
    .liquid-flow-animation {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(to right, #87CEEB, #1E90FF);
      animation: flowAnimation 3s linear infinite;
      opacity: 0.7;
    }
    .taste-icon {
      font-size: 80px;
      animation: bounce 1s infinite alternate;
    }

    .water-drop {
      position: absolute;
      width: 40px;
      height: 40px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%231e90ff" d="M50 5Q40 30 30 50Q20 70 50 95Q80 70 70 50Q60 30 50 5Z"/></svg>') no-repeat;
      background-size: contain;
      animation: float 4s ease-in-out infinite, pulse 1.5s infinite alternate; /* Added pulse */
      opacity: 0.7;
      filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.2)); /* Add shadow */
    }
    /* New: More water drops */
    .water-drop-extra {
      position: absolute;
      width: 25px;
      height: 25px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23ADD8E6" d="M50 5Q40 30 30 50Q20 70 50 95Q80 70 70 50Q60 30 50 5Z"/></svg>') no-repeat;
      background-size: contain;
      animation: float 3s ease-in-out infinite reverse, pulse 1s infinite alternate;
      opacity: 0.6;
      filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.1));
    }

    .fish {
      position: fixed;
      width: 80px;
      height: 50px;
      animation: swim 15s linear infinite;
      pointer-events: none;
      z-index: 0;
      transform: scaleX(1); /* Default direction */
    }
    .fish.swim-left {
      transform: scaleX(-1); /* Flip horizontally for swimming left */
    }
    .fish.small {
      width: 60px;
      height: 38px;
    }
    .fish.medium {
      width: 80px;
      height: 50px;
    }
    .fish.large {
      width: 100px;
      height: 62px;
    }
    /* Water Grass */
    .water-grass {
      position: absolute;
      bottom: 0;
      width: 80px;
      height: 60px;
      fill: #228B22;
      z-index: -1;
      animation: sway 5s ease-in-out infinite alternate;
    }
    /* Coral Reef */
    .coral-reef {
      position: absolute;
      bottom: 10px;
      width: 100px;
      height: 80px;
      fill: #FF6347;
      z-index: -1;
      animation: pulse 4s ease-in-out infinite alternate;
    }
    .coral-reef.type2 {
      fill: #DA70D6;
      width: 90px;
      height: 70px;
    }
    .coral-reef.type3 {
      fill: #FFD700;
      width: 110px;
      height: 90px;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-50px) rotate(5deg); }
    }

    @keyframes floatTitle {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0) rotate(0deg); }
      25% { transform: translateX(-5px) rotate(-2deg); }
      75% { transform: translateX(5px) rotate(2deg); }
    }
    @keyframes skyTransition {
      0% { background: linear-gradient(to bottom, #b3e0ff, #1e90ff); } /* Day */
      25% { background: linear-gradient(to bottom, #87CEEB, #1E90FF); } /* Mid-day */
      50% { background: linear-gradient(to bottom, #FFD700, #FF8C00); } /* Sunset */
      75% { background: linear-gradient(to bottom, #483D8B, #000080); } /* Night */
      100% { background: linear-gradient(to bottom, #b3e0ff, #1e90ff); } /* Back to Day */
    }
    
    @keyframes swim {
      0% { transform: translateX(-100px); }
      100% { transform: translateX(calc(100vw + 100px)); }
    }
    /* New: Reverse swim for some fish */
    @keyframes swimReverse {
      0% { transform: translateX(calc(100vw + 100px)) scaleX(-1); }
      100% { transform: translateX(-100px) scaleX(-1); }
    }

    @keyframes sway {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(3deg); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    @keyframes pulseBorder { /* New animation for title border */
      0%, 100% { border-color: #1e90ff; }
      50% { border-color: #FFD700; }
    }
    @keyframes waterFlow { /* New animation for water background */
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    @keyframes waterRipples { /* New animation for water surface */
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes flowAnimation {
      0% { background-position: 0% 0%; }
      100% { background-position: 100% 100%; }
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }


    .sun-moon {
      position: absolute;
      top: 85px;
      right: 40px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      animation: sunMoonCycle 20s linear infinite;
      z-index: 1; /* Ensure it's above sky but below title */
    }
    
    @keyframes sunMoonCycle {
      0% { /* Day - Sun */
        background: radial-gradient(circle, #ffff00, #ffcc00);
        box-shadow: 0 0 30px #ffff00;
        opacity: 1;
      }
      40% { /* Transition to Sunset */
        background: radial-gradient(circle, #ffcc00, #ff6600);
        box-shadow: 0 0 30px #ff6600;
        opacity: 1;
      }
      50% { /* Sunset/Dusk */
        background: radial-gradient(circle, #ff6600, #cc3300);
        box-shadow: 0 0 30px #cc3300;
        opacity: 0.8;
      }
      60% { /* Night - Moon */
        background: radial-gradient(circle, #f0f0f0, #c0c0c0);
        box-shadow: 0 0 20px #c0c0c0;
        opacity: 0.9;
        transform: rotate(360deg); /* Spin moon */
      }
      90% { /* Transition back to Day */
        background: radial-gradient(circle, #f0f0f0, #c0c0c0);
        box-shadow: 0 0 20px #c0c0c0;
        opacity: 0.9;
      }
      100% { /* Back to Day - Sun */
        background: radial-gradient(circle, #ffff00, #ffcc00);
        box-shadow: 0 0 30px #ffff00;
        opacity: 1;
      }
    }

    /* Go Back Button Styling */
    .go-back-btn {
      position: fixed;
      top: 65px;
      left: 20px;
      background-color: #87CEEB;
      color: #003366;
      padding: 10px 15px;
      border-radius: 25px;
      border: 3px solid #fff;
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      z-index: 11;
      transition: background-color 0.3s, transform 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      overflow: hidden;
    }

    .go-back-btn:hover {
      background-color: #6495ED;
      transform: scale(1.05);
    }

    .go-back-btn::before {
      content: '‚¨ÖÔ∏è';
      font-size: 20px;
    }

    /* New: Bubble for Go Back Button */
    .go-back-btn .bubble {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.5);
      border-radius: 50%;
      opacity: 0;
      animation: bubbleFloat 2s ease-out infinite;
      pointer-events: none;
    }

    /* New: Click Animation for Go Back Button */
    .go-back-btn.clicked {
      animation: buttonPop 0.3s ease-out;
    }

    @keyframes buttonPop {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @keyframes bubbleFloat {
      0% {
        transform: scale(0) translateY(0);
        opacity: 0;
      }
      20% {
        opacity: 1;
      }
      100% {
        transform: scale(1.2) translateY(-50px);
        opacity: 0;
      }
    }

    /* NEW: Styles for the arrow images (hidden by default, shown on desktop) */
    .concept-arrow {
      position: absolute;
      width: 100px;
      height: auto;
      z-index: 0;
      pointer-events: none;
      animation: pulseArrow 2s infinite alternate, floatArrow 3s ease-in-out infinite;
    }

    /* Positioning for each specific arrow (initial estimates, fine-tune these!) */
    #arrow-char {
      top: 220px;
      left: 25%;
      transform: rotate(45deg);
      transform-origin: center;
    }

    #arrow-flow {
      top: 220px;
      left: 47%;
      transform: translateX(-50%) rotate(90deg);
      transform-origin: center;
    }

    #arrow-taste {
      top: 220px;
      left: 70%;
      transform: rotate(135deg);
      transform-origin: center;
    }

    @keyframes pulseArrow {
      0% { transform: scale(1); opacity: 0.8; }
      100% { transform: scale(1.02); opacity: 1; }
    }

    /* New keyframes for floating animation */
    @keyframes floatArrow {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); } /* Adjust the float height as needed */
    }

    /* NEW: Flowing Water Arrows (hidden by default on desktop) */
    .flowing-arrow {
      display: none; /* Hidden on desktop by default */
      position: absolute;
      width: 50px; /* Adjust width as needed */
      height: 100px; /* Adjust height as needed */
      background: linear-gradient(to bottom, #87CEEB, #1E90FF);
      background-size: 100% 200%; /* Make background larger to animate flow */
      border-radius: 50% / 10%; /* Creates a rounded top/bottom */
      opacity: 0.7;
      animation: flowDown 2s linear infinite;
      z-index: 0; /* Behind boxes */
      pointer-events: none;
    }

    .flowing-arrow::after {
      content: '';
      position: absolute;
      bottom: -10px; /* Position the triangle below the main body */
      left: 50%;
      transform: translateX(-50%); /* No rotation here, parent handles angle */
      width: 20px;
      height: 20px;
      background: #1E90FF;
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%); /* Triangle shape */
      animation: pulseArrowTip 1s infinite alternate;
    }

    @keyframes flowDown {
      0% { background-position: 0% 0%; }
      100% { background-position: 0% 100%; } /* Animate background downwards */
    }

    @keyframes pulseArrowTip {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.1); }
    }


    /* Media Queries for Mobile Responsiveness */
    @media (max-width: 768px) {
      body {
        padding: 105px 10px 10px;
        overflow: auto;
        height: auto;
      }
      .title {
        font-size: 8vw;
        padding: 10px 20px;
        margin: 55px auto;
      }
      .title .box-hover-popup {
        font-size: 14px;
        bottom: -30px;
        padding: 5px 10px;
      }
      .container {
        flex-direction: column;
        gap: 20px;
        margin-top: 55px;
        align-items: center;
      }
      .box {
        width: 85%;
        max-width: 300px;
        font-size: 18px;
        padding: 20px;
        min-height: 120px;
        margin: 0 auto;
      }
      .box-hover-popup {
        font-size: 12px;
        bottom: -30px;
      }
      .popup {
        width: 90%;
        padding: 15px;
      }
      .popup h2 {
        font-size: 22px;
      }
      .popup p, .popup ul {
        font-size: 16px;
      }
      .water-drop, .water-drop-extra {
        width: 30px;
        height: 30px;
      }
      .fish {
        width: 60px;
        height: 38px;
      }
      .fish.small {
        width: 40px;
        height: 25px;
      }
      .fish.medium {
        width: 60px;
        height: 38px;
      }
      .fish.large {
        width: 80px;
        height: 50px;
      }
      .water-grass {
        width: 60px;
        height: 45px;
      }
      .coral-reef {
        width: 75px;
        height: 60px;
      }
      .coral-reef.type2 {
        width: 65px;
        height: 50px;
      }
      .coral-reef.type3 {
        width: 85px;
        height: 70px;
      }
      .sun-moon {
        width: 50px;
        height: 50px;
        top: 65px;
        right: 15px;
        box-shadow: 0 0 20px #ffff00;
        animation: sunMoonCycleMobile 10s linear infinite;
        position: fixed;
      }
      
      @keyframes sunMoonCycleMobile {
        0% { background: radial-gradient(circle, #ffff00, #ffcc00); box-shadow: 0 0 20px #ffff00; opacity: 1; }
        50% { background: radial-gradient(circle, #ff6600, #cc3300); box-shadow: 0 0 20px #cc3300; opacity: 0.8; }
        60% { background: radial-gradient(circle, #f0f0f0, #c0c0c0); box-shadow: 0 0 15px #c0c0c0; opacity: 0.9; transform: rotate(360deg); }
        100% { background: radial-gradient(circle, #ffff00, #ffcc00); box-shadow: 0 0 20px #ffff00; opacity: 1; }
      }

      /* Go Back Button for Mobile */
      .go-back-btn {
        top: 60px;
        left: 10px;
        padding: 8px 12px;
        font-size: 16px;
      }
      .go-back-btn::before {
        font-size: 18px;
      }

      /* Hide image arrows on mobile */
      .concept-arrow {
        display: none;
      }

      /* Show mobile flowing water arrows */
      .flowing-arrow {
        display: block; /* Make them visible on mobile */
      }

      #flowing-arrow-char {
        top: 180px;
        left: 25%;
        transform: translateX(-50%) rotate(-20deg); /* Angle towards the left box */
        height: 120px;
      }

      #flowing-arrow-flow {
        top: 180px;
        left: 50%;
        transform: translateX(-50%); /* Straight down */
        height: 120px;
      }

      #flowing-arrow-taste {
        top: 180px;
        left: 75%;
        transform: translateX(-50%) rotate(20deg); /* Angle towards the right box */
        height: 120px;
      }
    }

    @media (max-width: 480px) {
      .title {
        font-size: 9vw;
        padding: 8px 15px;
      }
      .title .box-hover-popup {
        font-size: 12px;
        bottom: -25px;
      }
      .box {
        width: 90%;
        font-size: 16px;
        padding: 15px;
        min-height: 100px;
        margin: 0 auto;
      }
      .box-hover-popup {
        font-size: 10px;
        bottom: -25px;
      }
      .popup {
        width: 95%;
        padding: 10px;
      }
      .popup h2 {
        font-size: 20px;
      }
      .popup p, .popup ul {
        font-size: 14px;
      }
      /* Adjust flowing arrow positions for smaller mobile screens */
      .flowing-arrow {
        width: 40px;
        height: 100px;
      }
      #flowing-arrow-char {
        top: 160px;
        left: 20%;
        height: 100px;
      }
      #flowing-arrow-flow {
        top: 160px;
        left: 50%;
        height: 100px;
      }
      #flowing-arrow-taste {
        top: 160px;
        left: 80%;
        height: 100px;
      }
    }

    /* New styles for video container */
    .video-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
      height: 0;
      overflow: hidden;
      margin-top: 15px;
      border-radius: 10px;
      background-color: black; /* To make sure it's visible even before video loads */
    }

    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    /* Style for the new "Manood ng Video" button */
    .video-btn {
      background-color: #4CAF50; /* Green */
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      cursor: pointer;
      margin-top: 20px;
      font-size: 18px;
      transition: background-color 0.3s, transform 0.2s;
    }

    .video-btn:hover {
      background-color: #45a049;
      transform: translateY(-2px);
    }
  </style>
  <script>
    // Keep track of visited boxes (opened at least once)
    const visitedBoxes = new Set();
    const totalConceptBoxes = 3; // Number of concept boxes
    let congratulationsShown = false; // Flag to ensure congratulations popup shows only once

    function showPopup(id) {
      const popup = document.getElementById(id);
      popup.style.display = 'block';
      setTimeout(() => {
        popup.classList.add('show');
      }, 10);

      // If the clicked popup is one of the concept boxes, add its ID to the visited set
      if (['popup-characteristics', 'popup-flow', 'popup-taste'].includes(id)) {
        visitedBoxes.add(id);
      }
    }

    function closePopup(id) {
      const popup = document.getElementById(id);
      popup.classList.remove('show');
      popup.addEventListener('transitionend', function handler() {
        popup.style.display = 'none';
        // If closing the congratulations popup, reset video and hide it
        if (id === 'popup-congratulations') {
          const videoFrame = document.getElementById('youtube-video');
          if (videoFrame) {
            videoFrame.src = ''; // Stop video playback
          }
          const videoContainer = document.querySelector('#popup-congratulations .video-container');
          if (videoContainer) {
            videoContainer.style.display = 'none'; // Hide video container
          }
          const learnMoreContent = document.getElementById('learn-more-content');
          if (learnMoreContent) {
            learnMoreContent.style.display = 'block'; // Show initial content
          }
        }
        popup.removeEventListener('transitionend', handler);

        // After any popup closes, check if all concept boxes have been visited AND all popups are closed
        checkAllBoxesVisitedAndClosed();
      });
    }

    function goBack() {
      const goBackButton = document.querySelector('.go-back-btn');
      goBackButton.classList.add('clicked');

      goBackButton.addEventListener('animationend', function handler() {
        goBackButton.classList.remove('clicked');
        goBackButton.removeEventListener('animationend', handler);
      });

      const activePopups = document.querySelectorAll('.popup.show');
      if (activePopups.length > 0) {
        closePopup(activePopups[activePopups.length - 1].id);
      } else {
        window.location.href = "index.html";
      }
    }

    function createBubbles() {
      const goBackButton = document.querySelector('.go-back-btn');
      if (!goBackButton) return;

      setInterval(() => {
        const bubble = document.createElement('div');
        bubble.classList.add('bubble');
        const size = Math.random() * 15 + 5;
        bubble.style.width = `${size}px`;
        bubble.style.height = `${size}px`;
        bubble.style.left = `${Math.random() * 100}%`;
        bubble.style.bottom = `0px`;
        bubble.style.animationDelay = `${Math.random() * 0.5}s`;
        goBackButton.appendChild(bubble);

        bubble.addEventListener('animationend', () => {
          bubble.remove();
        });
      }, 500);
    }

    // Function to create and append water drops dynamically
    function createWaterDrops() {
      const body = document.body;
      for (let i = 0; i < 8; i++) { // Create 8 extra water drops
        const drop = document.createElement('div');
        drop.classList.add('water-drop-extra');
        drop.style.left = `${Math.random() * 90 + 5}%`;
        drop.style.top = `${Math.random() * 60 + 5}%`; // Limit to upper part of the screen
        drop.style.animationDelay = `${Math.random() * 4}s`;
        body.appendChild(drop);
      }
    }

    // Function to create fish dynamically
    function createFish() {
      const waterBg = document.querySelector('.water-bg');
      const fishTypes = [
        { class: 'small', fill: '#FF6B6B', animation: 'swim', delay: 2, duration: 18 },
        { class: 'medium', fill: '#FF8800', animation: 'swimReverse', delay: 5, duration: 15 },
        { class: 'large', fill: '#FF4444', animation: 'swim', delay: 0, duration: 22 },
        { class: 'small', fill: '#55AAFF', animation: 'swimReverse', delay: 7, duration: 25 },
        { class: 'medium', fill: '#90EE90', animation: 'swim', delay: 3, duration: 20 },
        { class: 'large', fill: '#BA55D3', animation: 'swimReverse', delay: 9, duration: 17 }
      ];

      fishTypes.forEach(fishData => {
        const fishDiv = document.createElement('div');
        fishDiv.classList.add('fish', fishData.class);
        if (fishData.animation === 'swimReverse') {
          fishDiv.classList.add('swim-left');
        }
        fishDiv.style.top = `${75 + Math.random() * 20}%`; // Random vertical position in water
        fishDiv.style.animation = `${fishData.animation} ${fishData.duration}s linear infinite`;
        fishDiv.style.animationDelay = `${fishData.delay}s`;

        const fishSvg = `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 50">
            <path fill="${fishData.fill}" d="M80 25Q90 40 70 45Q60 50 50 35Q40 50 30 45Q10 40 20 25Q10 10 30 5Q40 0 50 15Q60 0 70 5Q90 10 80 25Z"/>
            <circle cx="70" cy="20" r="3" fill="#000"/>
          </svg>
        `;
        fishDiv.innerHTML = fishSvg;
        document.body.appendChild(fishDiv); // Append to body, not water-bg
      });
    }

    // New function to check if all concept boxes have been visited AND all popups are closed
    function checkAllBoxesVisitedAndClosed() {
      const currentlyOpenPopups = document.querySelectorAll('.popup.show');
      
      // Only show congratulations if all concept boxes have been visited, no other popups are open, AND it hasn't been shown yet
      if (visitedBoxes.size === totalConceptBoxes && currentlyOpenPopups.length === 0 && !congratulationsShown) {
        // Set the flag to true so it doesn't show again
        congratulationsShown = true; 
        // Show congratulations popup
        setTimeout(() => {
          showPopup('popup-congratulations');
        }, 500); // Small delay for better user experience
      }
    }

    // Function to show the YouTube video
    function showVideo() {
      const videoId = 'wgRuiIBbujY'; // Extracted from the URL
      const videoFrame = document.getElementById('youtube-video');
      const videoContainer = document.querySelector('#popup-congratulations .video-container');
      const learnMoreContent = document.getElementById('learn-more-content');

      videoFrame.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`; // Autoplay the video
      videoContainer.style.display = 'block'; // Make the video container visible
      learnMoreContent.style.display = 'none'; // Hide the initial text and button
    }


    window.onload = () => {
      createBubbles();
      createWaterDrops(); // Call new function to create more water drops
      createFish(); // Call new function to create fish dynamically
    };
  </script>
</head>
<body>
  <div class="water-bg">
    <!-- Water Grass -->
    <svg class="water-grass" style="left: 5%; animation-delay: 0s;" viewBox="0 0 100 100">
      <path d="M 0 100 Q 20 50 40 100 T 80 100 T 100 100 L 100 0 L 0 0 Z" />
    </svg>
    <svg class="water-grass" style="left: 20%; animation-delay: 0.5s; transform: scaleX(-1);" viewBox="0 0 100 100">
      <path d="M 0 100 Q 20 50 40 100 T 80 100 T 100 100 L 100 0 L 0 0 Z" />
    </svg>
    <svg class="water-grass" style="left: 40%; animation-delay: 1s;" viewBox="0 0 100 100">
      <path d="M 0 100 Q 20 50 40 100 T 80 100 T 100 100 L 100 0 L 0 0 Z" />
    </svg>
    <svg class="water-grass" style="left: 60%; animation-delay: 1.5s; transform: scaleX(-1);" viewBox="0 0 100 100">
      <path d="M 0 100 Q 20 50 40 100 T 80 100 T 100 100 L 100 0 L 0 0 Z" />
    </svg>
    <svg class="water-grass" style="left: 80%; animation-delay: 2s;" viewBox="0 0 100 100">
      <path d="M 0 100 Q 20 50 40 100 T 80 100 T 100 100 L 100 0 L 0 0 Z" />
    </svg>

    <!-- Coral Reefs -->
    <svg class="coral-reef" style="left: 15%; bottom: 5px; animation-delay: 0.3s;" viewBox="0 0 100 100">
      <path d="M50 0 C20 20 20 80 50 100 C80 80 80 20 50 0 Z M30 30 Q40 40 50 30 Q60 40 70 30 Q60 50 50 60 Q40 50 30 30 Z" />
    </svg>
    <svg class="coral-reef type2" style="left: 35%; bottom: 15px; animation-delay: 0.8s;" viewBox="0 0 100 100">
      <path d="M50 10 C20 30 30 70 50 90 C70 70 80 30 50 10 Z M40 40 Q50 50 60 40 Q50 60 40 40 Z" />
    </svg>
    <svg class="coral-reef type3" style="right: 25%; bottom: 0px; animation-delay: 1.2s;" viewBox="0 0 100 100">
      <path d="M50 0 C20 20 20 80 50 100 C80 80 80 20 50 0 Z M30 30 Q40 40 50 30 Q60 40 70 30 Q60 50 50 60 Q40 50 30 30 Z" />
    </svg>
    <svg class="coral-reef" style="right: 5%; bottom: 10px; animation-delay: 1.7s;" viewBox="0 0 100 100">
      <path d="M50 10 C20 30 30 70 50 90 C70 70 80 30 50 10 Z M40 40 Q50 50 60 40 Q50 60 40 40 Z" />
    </svg>
  </div>
  <div class="sun-moon"></div>
  
  <!-- Go Back Button -->
  <div class="go-back-btn" onclick="goBack()">Go back home! üè†</div>

  <div class="title" onclick="showPopup('popup-main');">
    üíß LIQUIDS üíß
    <div class="box-hover-popup">I-click para matuto pa!</div>
  </div>

  <!-- NEW: Arrow Images (hidden on mobile, shown on desktop) -->
  <img src="images/arrow_diagonal_left.png" alt="Arrow to Characteristics" class="concept-arrow" id="arrow-char">
  <img src="images/arrow_straight.png" alt="Arrow to Flow" class="concept-arrow" id="arrow-flow">
  <img src="images/arrow_diagonal_right.png" alt="Arrow to Taste" class="concept-arrow" id="arrow-taste">

  <!-- NEW: Flowing Water Arrows (only visible on mobile) -->
  <div class="flowing-arrow" id="flowing-arrow-char"></div>
  <div class="flowing-arrow" id="flowing-arrow-flow"></div>
  <div class="flowing-arrow" id="flowing-arrow-taste"></div>

  <div class="container">
    <div class="box" id="box-characteristics" onclick="showPopup('popup-characteristics')">
      Katangian ng Liquids
      <div class="box-hover-popup">I-click para matuto pa!</div>
    </div>
    <div class="box" id="box-flow" onclick="showPopup('popup-flow')">
      Paglalarawan ng Pagdaloy ng mga Liquids
      <div class="box-hover-popup">I-click para matuto pa!</div>
    </div>
    <div class="box" id="box-taste" onclick="showPopup('popup-taste')">
      Paglalarawan ng Liquids batay sa lasa
      <div class="box-hover-popup">I-click para matuto pa!</div>
    </div>
  </div>

  <!-- Main Popup for Liquids -->
  <div id="popup-main" class="popup">
    <h2>Ano ang Liquid?</h2>
    <p>Ang mga liquid ay mga bagay na may anyong likido. Sila ay dumadaloy at kumukuha ng anyo ng lalagyan na kanilang pinapasukan. Halimbawa, ang tubig, gatas, at juice ay mga liquid. Ang mga liquid ay hindi matigas at hindi rin sila gas. Sila ay may timbang at maaaring magbuhos!</p>
    <div class="popup-illustration-container">
      <!-- Animated SVG for water -->
      <svg width="100%" height="100%" viewBox="0 0 200 100" preserveAspectRatio="xMidYMid meet">
        <defs>
          <path id="wave" d="M0,10 C30,10 30,0 60,0 C90,0 90,10 120,10 L120,100 L0,100 Z" />
        </defs>
        <use href="#wave" fill="#87CEEB" opacity="0.7">
          <animate attributeName="x" from="0" to="-60" dur="4s" repeatCount="indefinite" />
        </use>
        <use href="#wave" fill="#1E90FF" opacity="0.5">
          <animate attributeName="x" from="-60" to="-120" dur="4s" repeatCount="indefinite" />
        </use>
        <circle cx="100" cy="50" r="15" fill="#ADD8E6" opacity="0.8">
          <animate attributeName="cy" from="50" to="40" dur="2s" repeatCount="indefinite" alternate />
          <animate attributeName="r" from="15" to="18" dur="2s" repeatCount="indefinite" alternate />
        </circle>
        <text x="100" y="55" font-family="Comic Sans MS" font-size="15" fill="#003366" text-anchor="middle">üíß</text>
      </svg>
    </div>
    <button class="close-btn" onclick="closePopup('popup-main')">Isara</button>
  </div>

  <!-- New Popup for Characteristics of Liquids -->
  <div id="popup-characteristics" class="popup">
    <h2>Katangian ng Liquids</h2>
    <p>Ang mga liquid ay may mga katangian tulad ng:</p>
    <ul>
        <li>May anyong likido at kumukuha ng anyo ng lalagyan.</li>
        <li>May timbang at maaaring magbuhos.</li>
        <li>Hindi matigas at hindi gas.</li>
    </ul>
    <div class="popup-illustration-container">
      <!-- Animated SVG for characteristics (e.g., pouring liquid into different shapes) -->
      <svg width="100%" height="100%" viewBox="0 0 200 100" preserveAspectRatio="xMidYMid meet">
        <rect x="10" y="40" width="40" height="50" fill="#ADD8E6" rx="5" ry="5" />
        <circle cx="100" cy="65" r="25" fill="#ADD8E6" />
        <polygon points="150,90 170,40 190,90" fill="#ADD8E6" />
        
        <!-- Pouring animation -->
        <path id="liquid-path" d="M70,10 C75,20 75,30 70,40" stroke="#1E90FF" stroke-width="5" fill="none">
          <animateMotion path="M70,10 C75,20 75,30 70,40" begin="0s" dur="3s" repeatCount="indefinite" />
        </path>
        <circle r="5" fill="#1E90FF">
          <animateMotion dur="3s" repeatCount="indefinite" path="M70,10 C75,20 75,30 70,40 L25,65" />
        </circle>
        <circle r="5" fill="#1E90FF">
          <animateMotion dur="3s" repeatCount="indefinite" path="M70,10 C75,20 75,30 70,40 L100,65" begin="1s" />
        </circle>
        <circle r="5" fill="#1E90FF">
          <animateMotion dur="3s" repeatCount="indefinite" path="M70,10 C75,20 75,30 70,40 L170,65" begin="2s" />
        </circle>
        <text x="70" y="10" font-family="Comic Sans MS" font-size="20" text-anchor="middle">üíß</text>
      </svg>
    </div>
    <button class="close-btn" onclick="closePopup('popup-characteristics')">Isara</button>
  </div>

  <!-- New Popup for Flow of Liquids -->
  <div id="popup-flow" class="popup">
    <h2>Paglalarawan ng Pagdaloy ng mga Liquids</h2>
    <p>Ang mga liquid ay dumadaloy pababa, parang tubig sa isang slide! Ang bilis ng daloy ay nakadepende sa:</p>
    <ul>
        <li><b>Viscosity</b> (kapal ng likido) - Ang honey (üëÜ makapal) ay mabagal, pero tubig (üëá malabnaw) ay mabilis</li>
        <li><b>Temperatura</b> - Mainit (üî•) = mabilis, malamig (‚ùÑÔ∏è) = mabagal</li>
        <li><b>Pressure</b> (diin) - Parang pagpisil ng bote, mas maraming pressure = mas mabilis ang daloy</li>
    </ul>
    <div class="popup-illustration-container">
      <!-- Animated illustration of liquid flowing down a slope -->
      <svg width="100%" height="100%" viewBox="0 0 200 100" preserveAspectRatio="xMidYMid meet">
        <rect x="0" y="70" width="200" height="30" fill="#ccc" /> <!-- Ground -->
        <rect x="10" y="50" width="180" height="20" fill="#aaa" transform="rotate(5 10 50)" /> <!-- Slope -->
        
        <!-- Liquid drops flowing down -->
        <circle cx="20" cy="45" r="5" fill="#1E90FF">
          <animateMotion path="M20,45 L180,65" dur="3s" repeatCount="indefinite" />
        </circle>
        <circle cx="20" cy="45" r="5" fill="#87CEEB">
          <animateMotion path="M20,45 L180,65" dur="3s" repeatCount="indefinite" begin="1s" />
        </circle>
        <circle r="5" fill="#1E90FF">
          <animateMotion path="M20,45 L180,65" dur="3s" repeatCount="indefinite" begin="2s" />
        </circle>
        <text x="100" y="30" font-family="Comic Sans MS" font-size="20" text-anchor="middle">‚¨áÔ∏è</text>
      </svg>
    </div>
    <button class="close-btn" onclick="closePopup('popup-flow')">Isara</button>
  </div>

  <!-- New Popup for Taste of Liquids -->
  <div id="popup-taste" class="popup">
    <h2>Paglalarawan ng Liquids batay sa lasa</h2>
    <p>Ang mga liquid ay maaaring magkaroon ng iba't ibang lasa, tulad ng:</p>
    <ul>
        <li>Matamis (tulad ng juice at gatas) üçØü•õüòã</li>
        <li>Maasim (tulad ng suka at kalamansi) üçãü§¢üò´</li>
        <li>Mapait (tulad ng gamot at kape) üíäü§Æüòñ</li>
        <li>Maalat (tulad ng sabaw at tubig dagat) üßÇüòãüòä</li>
        <li>Maanghang (tulad ng spicy na juice) üå∂Ô∏èü•µ</li>
        <li>Walang lasa (tulad ng tubig) üö∞üòê</li>
    </ul>
    <div class="popup-illustration-container">
      <!-- Animated taste icons with more variety and colors -->
      <span class="taste-icon" style="color: gold;">üçØ</span>
      <span class="taste-icon" style="color: yellow; animation-delay: 0.2s;">ü•õ</span>
      <span class="taste-icon" style="color: #ff9500; animation-delay: 0.4s;">ü§¢</span>
      <span class="taste-icon" style="color: #964B00; animation-delay: 0.6s;">ü§Æ</span>
      <span class="taste-icon" style="color: deepskyblue; animation-delay: 0.8s;">üòã</span>
      <span class="taste-icon" style="color: red; animation-delay: 1.0s;">üå∂Ô∏è</span>
      <span class="taste-icon" style="color: lightblue; animation-delay: 1.2s;">üö∞</span>
    </div>
    <button class="close-btn" onclick="closePopup('popup-taste')">Isara</button>
  </div>

  <!-- New: Congratulations Popup -->
  <div id="popup-congratulations" class="popup">
    <h2>üéâ Binabati Kita! üéâ</h2>
    <div id="learn-more-content">
      <p>Kumpleto mo nang natutunan ang mga pangunahing konsepto tungkol sa Liquids!</p>
      <p>Gusto mo pa bang matuto nang higit pa?</p>
      <button class="video-btn" onclick="showVideo()">Manood ng Video!</button>
    </div>
    <div class="video-container" style="display: none;">
      <iframe id="youtube-video" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
    <button class="close-btn" onclick="closePopup('popup-congratulations')">Isara</button>
  </div>

  <!-- Water drops -->
  <div class="water-drop" style="left: 10%; top: 30%; animation-delay: 0s;"></div>
  <div class="water-drop" style="left: 25%; top: 40%; animation-delay: 1s;"></div>
  <div class="water-drop" style="left: 75%; top: 35%; animation-delay: 2s;"></div>
  <div class="water-drop" style="left: 90%; top: 25%; animation-delay: 3s;"></div>

  <!-- Fish are now created dynamically by JavaScript -->
</body>
</html>
